<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="js/web3.min.js"></script>
    <script type="text/javascript" src="js/secrets.js"></script>
    <script type="text/javascript">
        window.addEventListener('load', function () {
            if (typeof web3 !== 'undefined') {
                console.log('Web3 Detected! ' + web3.currentProvider.constructor.name)
                window.web3 = new Web3(web3.currentProvider);
            } else {
                console.log('No Web3 Detected...using HTTP Provider')
                window.web3 = new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/" + config.infuraKey));
            }
            readOnly()
        });

        function getContracts() {
            var addresses = {
                Hash: "0xa7620C421d29db2bb991cD603a725b960E927cEd",
                Prover: "0x1f5cDff41Fb9B17996D6F0fcA6Ab9C5bEd96F20f"
            };
            var abis = {
                Hash: [{"constant":false,"inputs":[],"name":"selfDestruct","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"dataString","type":"string"}],"name":"hash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"pure","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":false,"stateMutability":"nonpayable","type":"fallback"}],
                Prover: [{"constant":true,"inputs":[{"name":"target","type":"address"},{"name":"dataHash","type":"bytes32"}],"name":"entryInformation","outputs":[{"name":"proved","type":"bool"},{"name":"time","type":"uint256"},{"name":"staked","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"dataHash","type":"bytes32"}],"name":"addEntry","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"registeredUsers","outputs":[{"name":"number_unique_addresses","type":"uint256"},{"name":"unique_addresses","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"selfDestruct","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"target","type":"address"}],"name":"userEntries","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"dataHash","type":"bytes32"}],"name":"deleteEntry","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":false,"stateMutability":"nonpayable","type":"fallback"}]
            };
            var contracts = {
                Hash: web3.eth.contract(abis.Hash).at(addresses.Hash),
                Prover: web3.eth.contract(abis.Prover).at(addresses.Prover)
            }
            return contracts
        };

        function hash() {
            var message, messageHash;
            var Hash = getContracts().Hash;
            message = document.getElementById("message").value
            try {
                Hash.hash.call(message, function (error, messageHash) {
                    if (! error) {
                        document.getElementById("messageHash").innerHTML = messageHash;
                    }
                });
            } catch (err) {
                document.getElementById("messageHash").innerHTML = err;
            }
        };

        // populate read-only data
        function readOnly() {
            var users;
            var Prover = getContracts().Prover;
            try {
                Prover.registeredUsers.call(function (error, users) {
                    if (! error) {
                        document.getElementById("numUsers").innerHTML = users[0].toNumber();
                        document.getElementById("users").innerHTML = users[1];
                    }
                });
            } catch (err) {
                document.getElementById("numUsers").innerHTML = err;
                document.getElementById("users").innerHTML = err;
            }
        }
    </script>
</head>

<body>
    <h1>ProveIt</h1>
    <p>Number of Registered Addresses:</p><div id="numUsers"></div>
    <p>Registered Addresses:</p><div id="users"></div>
    <br />
    <p>Hash your Message:</p>
    <input type="text" id="message" placeholder= "Your message here."/>
    <button type="button" onClick="hash();">Hash</button>
    <div id="messageHash"></div>
</body>

</html>
